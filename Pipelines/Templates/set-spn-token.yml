parameters:
  - name: serviceConnection
    type: string

steps:
- pwsh: |
    $pipelineUtilsPath = "$(Agent.BuildDirectory)/PipelineUtils"
    $powerShellPath = "$pipelineUtilsPath/PowerShell"
    Write-Host "##vso[task.setvariable variable=PowerShellPath]$powerShellPath"

    . "$powerShellPath/dataverse-webapi-functions.ps1"
    Write-Host $env:TENANTID $env:CLIENTID $env:CLIENTSECRET "${{parameters.serviceConnection}}" $env:AADHOST
    Set-SpnTokenVariableWithinAgent $env:TENANTID $env:CLIENTID "$(ClientSecret)" "${{parameters.serviceConnection}}" $env:AADHOST
  displayName: "Set SpnToken for use by other tasks that need one"